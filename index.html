<!DOCTYPE html>
<html lang=en>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/styles.css">

    <title>Conway's Game of Life</title>
</head>

<body>
    <header class="jumbotron">
        <div class="container">
            <div class="row">
                <h1>Conway's Game of Life</h1>
            </div>
    </header>

    <div class="container">
        <div class="row row-content">
            <div class="btn-group" role="group">
                <button class="btn btn-primary" id="run">Run</button>
                <button class="btn btn-danger" id="stop">Stop</button>
            </div>
            <div class="btn-group mb-auto" role="group">
                <button class="btn btn-warning text-white" id="beauty">Beautiful</button>
                <button class="btn btn-success" id="random">Random</button>
            </div>
            <div class="dropdown">
                <button class="btn btn-info dropdown-toggle" type="button" id="sizeButton" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    Reset Board
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" id="board1"><span style="font-size:20px">12*12</span></a>
                    <a class="dropdown-item" id="board2"><span style="font-size:25px">24*24</span></a>
                    <a class="dropdown-item" id="board3"><span style="font-size:30px">36*36</span></a>
                    <a class="dropdown-item" id="board4"><span style="font-size:35px">48*48</span></a>
                </div>
            </div>
        </div>
        <div class="row row-content" id="board"></div>
    </div>

    <script src="node_modules/jquery/dist/jquery.slim.min.js"></script>
    <script src="node_modules/popper.js/dist/umd/popper.min.js"></script>
    <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script>
        window.addEventListener("load", () => {
            let boardSize = 1;
            let clickable = []
            let timerReference = undefined

            function drawBoard(size) {
                let boardContainer = document.createElement("div")
                boardContainer.classList.add("container")
                boardContainer.setAttribute('id', 'boardContainer')
                for (let i = 0; i < size; i++) {
                    let boardUnit = document.createElement("div")
                    boardUnit.classList.add("row")
                    boardUnit = drawBoardUnit(boardUnit, size, i)
                    boardContainer.append(boardUnit)
                }
                $("#board").append(boardContainer)
                addCellListener();
            }

            /* A boardUnit contains a row of cellContainers. */
            function drawBoardUnit(boardUnit, boardSize, boardUnitIndex) {

                let newBoardUnit = boardUnit
                for (let i = 0; i < boardSize; i++) {
                    let cellContainer = document.createElement("div")
                    cellContainer.classList.add("container")
                    cellContainer.classList.add(`col-${12 / Number(boardSize)}`)
                    cellContainer = drawCellContainer(boardUnitIndex, i, cellContainer)
                    newBoardUnit.append(cellContainer)
                }
                return newBoardUnit
            }

            /* A cellContainer contains 12 rows of cells. */
            function drawCellContainer(BoardUnitIndex, cellContainerIndex, cellContainer) {
                let newCellContainer = cellContainer
                for (let i = 0; i < 12; i++) {
                    let cellRow = document.createElement("div")
                    cellRow.classList.add("row")
                    cellRow = drawCellRow(BoardUnitIndex, cellContainerIndex, i, cellRow)
                    newCellContainer.append(cellRow)
                }
                return newCellContainer
            }

            /* A cellRow contains 12 cells. */
            function drawCellRow(BoardUnitIndex, cellContainerIndex, cellRowIndex, cellRow) {
                let newCellRow = cellRow
                for (let i = 0; i < 12; i++) {
                    let cell = document.createElement("div")
                    cell.classList.add("cell")
                    cell.classList.add("col-1")
                    cell.classList.add("p-0")
                    cell.classList.add("dead")
                    cell = getCellCoord(BoardUnitIndex, cellContainerIndex, cellRowIndex, i, cell)
                    newCellRow.append(cell)
                }
                return newCellRow
            }

            function getCellCoord(boardUnitIndex, cellContainerIndex, cellRowIndex, cellIndex, cell) {
                let newCell = cell
                let cellCoordX = 12 * cellContainerIndex + cellIndex;
                let cellCoordY = 12 * boardUnitIndex + cellRowIndex;
                newCell.setAttribute("coordx", cellCoordX)
                newCell.setAttribute("coordy", cellCoordY)
                return newCell
            }

            function addCellListener() {
                $(".cell").click(() => {
                    if ($(this).hasClass("dead")) {
                        $(this).removeClass("dead")
                        $(this).addClass("alive")
                    } else if ($(this).hasClass("alive")) {
                        $(this).removeClass("alive")
                        $(this).addClass("dead")
                    }
                })
            }

            $("#board1").click(() => {
                $("#board").empty()
                drawBoard(1)
                boardSize = 1
            })

            $("#board2").click(() => {
                $("#board").empty()
                drawBoard(2)
                boardSize = 2
            })

            $("#board3").click(() => {
                $("#board").empty()
                drawBoard(3)
                boardSize = 3
            })

            $("#board4").click(() => {
                $("#board").empty()
                drawBoard(4)
                boardSize = 4
            })

            $("#run").click(() => {
                run()
            })

            function run() {
                if (timerReference === undefined) {
                    timerReference = setInterval(run, 200)
                }

                clickable.forEach((element, index) => {
                    element.style.pointerEvents = "none"
                })

                let cells = document.querySelectorAll(".cell")
                cells.forEach(checkNeighbors)
                cells.forEach(stateColor)

            }

            function addClickables() {
                clickable.push(document.querySelector("#run"))
                clickable.push(document.querySelector("#beauty"))
                clickable.push(document.querySelector("#random"))
                clickable.push(document.querySelector("#sizeButton"))
                clickable.push(document.querySelector("#boardContainer"))
            }


            function checkNeighbors(cell, index) {
                let aliveNeighborNum = 0;
                let x = Number(cell.getAttribute("coordx"))
                let y = Number(cell.getAttribute("coordy"))

                for (i = Math.max(x - 1, 0); i < Math.min(x + 2, boardSize * 12); i++) {
                    for (j = Math.max(y - 1, 0); j < Math.min(y + 2, boardSize * 12); j++) {
                        if (document.querySelector(`[coordx="${i}"][coordy="${j}"]`).classList.contains("alive")
                            && !(i === x && j === y)) {
                            aliveNeighborNum++
                        }
                    }
                }

                if (aliveNeighborNum < 2 || aliveNeighborNum > 3) {
                    cell.classList.add("die")
                } else if (aliveNeighborNum === 3) {
                    cell.classList.add("born")
                } else {
                    if (cell.classList.contains("alive")) {
                        cell.classList.add("born")
                    } else if (cell.classList.contains("dead")) {
                        cell.classList.add("die")
                    }
                }
            }

            function stateColor(cell, index) {
                if (cell.classList.contains("dead") && cell.classList.contains("die")) {
                    cell.classList.remove("die")
                } else if (cell.classList.contains("alive") && cell.classList.contains("die")) {
                    cell.classList.remove("die")
                    die(cell)
                } else if (cell.classList.contains("alive") && cell.classList.contains("born")) {
                    cell.classList.remove("born")
                } else if (cell.classList.contains("dead") && cell.classList.contains("born")) {
                    cell.classList.remove("born")
                    born(cell)

                }
            }

            $("#stop").click(() => {
                clickable.forEach((element, index) => {
                    element.style.pointerEvents = "all"
                })
                clearInterval(timerReference)
                timerReference = undefined
            })

            $("#random").click(() => {
                clearboard()

                let alivecells = []
                for (let i = 0; i < boardSize * 48; i++) {
                    let j = getRandomInt()
                    let k = getRandomInt()
                    alivecells.push(document.querySelector(`[coordx="${j}"][coordy="${k}"]`))
                }

                alivecells.forEach((cell, index) => {
                    cell.classList.remove("dead")
                    cell.classList.add("alive")
                })

                run()
            })

            function getRandomInt() {
                return Math.floor(Math.random() * boardSize * 12)
            }

            function born(cell) {
                cell.classList.remove("dead")
                cell.classList.add("alive")
            }

            function die(cell) {
                cell.classList.remove("alive")
                cell.classList.add("dead")
            }

            function clearboard() {
                $(".cell").ready(() => {
                    if ($(this).hasClass("alive")) {
                        $(this).removeClass("alive")
                        $(this).addClass("dead")
                    }
                })
            }

            drawBoard(1)
            addClickables()
        })
    </script>

    </div>
</body>

</html>